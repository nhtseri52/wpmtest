const ADMIN_EMAIL = "nhtseri52@gmail.com";

function checkAuth() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user && !window.location.href.includes('login.html')) {
        window.location.href = 'login.html';
    }
    return user;
}

function renderSidebar(activePage) {
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    const isAdmin = user.e === ADMIN_EMAIL;

    let html = `
        <div class="card user-card ${isAdmin ? 'admin-border' : ''}">
            <div class="nav-item" style="flex-direction:column; align-items:flex-start; height:auto">
                <div style="display:flex; width:100%; align-items:center">
                    <b>${user.u || 'Khách'}</b>
                    ${isAdmin ? '<span class="admin-badge">CHỦ WEB</span>' : ''}
                </div>
                <small style="color:#888; font-size:11px">${user.e || ''}</small>
            </div>
            <div class="nav-item" style="color:#e74c3c; cursor:pointer" onclick="logout()">
                <i class="fa-solid fa-power-off"></i> Đăng xuất
            </div>
        </div>
        ${isAdmin ? `
        <div class="card admin-stats">
            <small>ONLINE USERS</small>
            <div id="online-val">${Math.floor(Math.random()*15)+5}</div>
        </div>` : ''}
        <div class="card nav-menu">
            <a href="index.html" class="nav-item ${activePage==='index.html'?'active':''}">
                <i class="fa-solid fa-keyboard"></i> Mục 1: Tập gõ
            </a>
            <a href="guide.html" class="nav-item ${activePage==='guide.html'?'active':''}">
                <i class="fa-solid fa-graduation-cap"></i> Mục 2: Hướng dẫn
            </a>
            <a href="rank.html" class="nav-item ${activePage==='rank.html'?'active':''}">
                <i class="fa-solid fa-trophy"></i> Mục 3: Xếp hạng
            </a>
            <a href="community.html" class="nav-item ${activePage==='community.html'?'active':''}">
                <i class="fa-solid fa-users"></i> Mục 4: Cộng đồng
            </a>
            <a href="custom.html" class="nav-item ${activePage==='custom.html'?'active':''}">
                <i class="fa-solid fa-tools"></i> Mục 5: Tùy chỉnh
            </a>
            ${isAdmin ? `
            <a href="admin.html" class="nav-item ${activePage==='admin.html'?'active':''}" style="background:#fff3cd; color:#856404">
                <i class="fa-solid fa-user-shield"></i> GOD MODE
            </a>` : ''}
        </div>
    `;
    document.getElementById('sidebar-inject').innerHTML = html;
}

function logout() {
    localStorage.removeItem('user');
    window.location.href = 'login.html';
}

// CSS Chung dùng cho tất cả các file
const style = document.createElement('style');
style.innerHTML = `
    :root { --primary: #2980b9; --bg: #ecf0f1; --gold: #f1c40f; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; padding: 20px; gap: 20px; margin: 0; }
    .sidebar { width: 300px; flex-shrink: 0; }
    .content { flex-grow: 1; background: white; padding: 30px; border-radius: 12px; min-height: 85vh; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .card { background: white; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 15px; overflow: hidden; }
    .nav-item { padding: 15px; display: flex; align-items: center; text-decoration: none; color: #555; border-bottom: 1px solid #f1f1f1; transition: 0.2s; }
    .nav-item:hover { background: #f9f9f9; }
    .nav-item.active { background: var(--primary); color: white; border: none; }
    .nav-item i { width: 30px; font-size: 18px; }
    .admin-badge { background: var(--gold); color: black; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: auto; font-weight: bold; }
    .admin-border { border: 2px solid var(--gold); }
    .admin-stats { background: #2c3e50 !important; color: white; padding: 20px; text-align: center; }
    #online-val { font-size: 32px; color: var(--gold); font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
    .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: var(--primary); color: white; }
`;
document.head.appendChild(style);
