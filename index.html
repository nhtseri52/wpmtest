<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master Pro - VN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #4a90e2; --bg: #f0f2f5; --border: #ddd; --success: #2ecc71; --error: #e74c3c; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; padding: 20px; }
        
        .main-wrapper { display: flex; gap: 20px; width: 100%; max-width: 1200px; }
        
        /* Sidebar */
        .sidebar { width: 280px; flex-shrink: 0; }
        .menu-group { background: white; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 15px; overflow: hidden; }
        .menu-item { padding: 12px 15px; display: flex; align-items: center; cursor: pointer; color: #333; text-decoration: none; border-bottom: 1px solid #eee; transition: 0.2s; }
        .menu-item:hover { background: #f9f9f9; }
        .menu-item.active { background: var(--primary); color: white; }
        .menu-item i { width: 25px; margin-right: 10px; }

        /* Content Area */
        .content-card { flex-grow: 1; background: white; padding: 25px; border-radius: 8px; border: 1px solid var(--border); min-height: 500px; position: relative; }
        
        /* Typing Engine */
        .word-box { background: #f8f9fa; padding: 20px; border-radius: 8px; font-size: 22px; line-height: 1.8; height: 100px; overflow: hidden; display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; border: 1px solid #eee; }
        .word { color: #888; }
        .word.current { background: #d1d8e0; border-radius: 4px; padding: 0 5px; color: #333; }
        .word.correct { color: var(--success); }
        .word.incorrect { color: var(--error); text-decoration: underline; }
        
        .input-line { display: flex; gap: 10px; align-items: center; }
        input[type="text"], input[type="password"], input[type="email"], textarea { padding: 12px; border: 1px solid var(--border); border-radius: 4px; font-size: 16px; }
        input#typing-input { flex: 1; font-size: 20px; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; background: var(--primary); color: white; font-weight: bold; }
        .btn-green { background: var(--success); }

        /* Auth Modals */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 350px; position: relative; }
        
        /* Custom UI */
        .hidden { display: none !important; }
        .timer-badge { background: var(--primary); color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 1.2rem; }
        
        /* Top 100 Table */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid var(--border); text-align: center; }
        th { background: #f4f4f4; }

        /* Finger Guide Image Simulation */
        .finger-guide { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px; }
        .hand-card { border: 1px solid var(--border); padding: 15px; border-radius: 8px; text-align: center; }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <div class="sidebar">
            <div id="auth-section" class="menu-group">
                <div class="menu-item" onclick="showModal('login-modal')"><i class="fa-solid fa-user-lock"></i> Đăng nhập / Đăng ký</div>
            </div>

            <div id="user-section" class="menu-group hidden">
                <div class="menu-item active" onclick="switchTab('tab-1')"><i class="fa-solid fa-keyboard"></i> Mục 1: Tập đánh máy</div>
                <div class="menu-item" onclick="switchTab('tab-2')"><i class="fa-solid fa-hand"></i> Mục 2: Hướng dẫn 10 ngón</div>
                <div class="menu-item" onclick="switchTab('tab-3')"><i class="fa-solid fa-trophy"></i> Mục 3: Top 100</div>
                <div class="menu-item" onclick="switchTab('tab-4')"><i class="fa-solid fa-share-nodes"></i> Mục 4: Chia sẻ văn bản</div>
                <div class="menu-item" onclick="switchTab('tab-5')"><i class="fa-solid fa-sliders"></i> Mục 5: Văn bản tùy chỉnh</div>
            </div>

            <div id="profile-section" class="menu-group hidden">
                <div class="menu-item" onclick="switchTab('tab-profile')"><i class="fa-solid fa-address-card"></i> Hồ sơ</div>
                <div class="menu-item" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</div>
            </div>
        </div>

        <div class="content-card">
            <div id="tab-1" class="tab-content">
                <h2>Tập đánh máy (Top 200 từ)</h2>
                <div class="settings-bar" style="margin-bottom: 15px;">
                    <button class="btn-time active" onclick="setTime(30)">30s</button>
                    <button class="btn-time" onclick="setTime(60)">1p</button>
                </div>
                <div id="word-display" class="word-box"></div>
                <div class="input-line">
                    <input type="text" id="typing-input" placeholder="Gõ để bắt đầu...">
                    <div id="timer" class="timer-badge">30</div>
                    <button class="btn" onclick="resetTyping()">Làm lại</button>
                </div>
            </div>

            <div id="tab-2" class="tab-content hidden">
                <h2>Hướng dẫn gõ 10 ngón</h2>
                <p>Nguyên tắc vàng: **Không bao giờ nhìn xuống bàn phím.**</p>
                <div class="finger-guide">
                    <div class="hand-card">
                        <h3>Tay Trái</h3>
                        <p>Ngón Út: A, Q, Z, 1, Tab</p>
                        <p>Ngón Áp Út: S, W, X, 2</p>
                        <p>Ngón Giữa: D, E, C, 3</p>
                        <p>Ngón Trỏ: F, G, R, T, V, B, 4, 5</p>
                    </div>
                    <div class="hand-card">
                        <h3>Tay Phải</h3>
                        <p>Ngón Trỏ: H, J, Y, U, N, M, 6, 7</p>
                        <p>Ngón Giữa: K, I, ,, 8</p>
                        <p>Ngón Áp Út: L, O, ., 9</p>
                        <p>Ngón Út: ;, P, /, 0, Enter</p>
                    </div>
                </div>
                <p style="text-align: center; margin-top: 20px; font-weight: bold; color: var(--primary);">2 ngón cái luôn đặt trên phím Cách (Space)!</p>
            </div>

            <div id="tab-3" class="tab-content hidden">
                <h2>Bảng xếp hạng Top 100</h2>
                <table id="leaderboard">
                    <thead><tr><th>Hạng</th><th>Tên</th><th>WPM</th><th>Ngày</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <div id="tab-4" class="tab-content hidden">
                <h2>Chia sẻ văn bản & Gõ chung</h2>
                <textarea id="share-text-input" placeholder="Nhập văn bản bạn muốn chia sẻ..." style="width: 100%; height: 100px; margin-bottom: 10px;"></textarea>
                <button class="btn btn-green" onclick="publishText()">Đăng văn bản</button>
                <div id="shared-list" style="margin-top: 20px;"></div>
            </div>

            <div id="tab-5" class="tab-content hidden">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Văn bản tùy chỉnh</h2>
                    <button class="btn" onclick="showModal('custom-config-modal')"><i class="fa-solid fa-cog"></i> Cài đặt từ</button>
                </div>
                <div id="custom-word-display" class="word-box"></div>
                <div class="input-line">
                    <input type="text" id="custom-typing-input" placeholder="Gõ từ tùy chỉnh...">
                    <button class="btn" onclick="initCustomTyping()">Reset</button>
                </div>
            </div>

            <div id="tab-profile" class="tab-content hidden">
                <h2>Thông tin cá nhân</h2>
                <div class="hand-card" style="text-align: left;">
                    <p><strong>Tài khoản:</strong> <span id="p-username">***</span></p>
                    <p><strong>Gmail:</strong> <span id="p-gmail">***</span></p>
                    <p><strong>Ngày gia nhập:</strong> <span id="p-date">--/--/----</span></p>
                    <hr>
                    <h3>Đổi mật khẩu</h3>
                    <input type="password" id="new-pw" placeholder="Mật khẩu mới" style="display: block; margin-bottom: 10px;">
                    <button class="btn" onclick="changePassword()">Cập nhật</button>
                </div>
            </div>
        </div>
    </div>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h3>Đăng nhập / Đăng ký</h3>
            <input type="text" id="auth-user" placeholder="Tên tài khoản" style="width: 90%; margin-bottom: 10px;">
            <input type="email" id="auth-email" placeholder="Gmail" style="width: 90%; margin-bottom: 10px;">
            <input type="password" id="auth-pass" placeholder="Mật khẩu" style="width: 90%; margin-bottom: 15px;">
            <button class="btn" style="width: 100%;" onclick="handleAuth()">Xác nhận</button>
            <button class="btn" style="width: 100%; background: #ccc; margin-top: 5px;" onclick="closeModals()">Hủy</button>
        </div>
    </div>

    <div id="custom-config-modal" class="modal">
        <div class="modal-content" style="width: 450px;">
            <h3>Cài đặt từ tùy chỉnh</h3>
            <p>Nhập các từ cách nhau bởi dấu <b>|</b></p>
            <textarea id="config-words-raw" style="width: 100%; height: 150px;">tôi|yêu|lập|trình|việt|nam</textarea>
            <button class="btn" style="margin-top: 10px;" onclick="saveCustomConfig()">Lưu & Đóng</button>
        </div>
    </div>

    <script>
        // DATA & STATE
        let currentUser = JSON.parse(localStorage.getItem('typing_user')) || null;
        let dictionary = "học|sinh|trường|chuyên|nghiệp|lập|trình|viên|công|nghệ|thông|tin|vui|vẻ|hạnh|phúc|thành|công".split('|');
        let currentWords = [];
        let currentIndex = 0;
        let timeLeft = 30;
        let timer = null;
        let correctChars = 0;

        // AUTH LOGIC
        function handleAuth() {
            const user = document.getElementById('auth-user').value;
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            
            if(!user || !pass) return alert("Vui lòng điền đủ!");

            currentUser = { 
                username: user, 
                email: email, 
                joinedDate: new Date().toLocaleDateString(),
                password: pass
            };
            localStorage.setItem('typing_user', JSON.stringify(currentUser));
            updateUI();
            closeModals();
        }

        function logout() {
            localStorage.removeItem('typing_user');
            location.reload();
        }

        function updateUI() {
            if(currentUser) {
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('user-section').classList.remove('hidden');
                document.getElementById('profile-section').classList.remove('hidden');
                
                // Cập nhật Profile bị che
                document.getElementById('p-username').innerText = currentUser.username.slice(0, 2) + "****";
                document.getElementById('p-gmail').innerText = currentUser.email ? currentUser.email.slice(0, 3) + "****@gmail.com" : "Chưa cập nhật";
                document.getElementById('p-date').innerText = currentUser.joinedDate;
            }
            updateLeaderboard();
        }

        // TAB LOGIC
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            if(tabId === 'tab-1') initTyping();
            if(tabId === 'tab-5') initCustomTyping();
        }

        // MỤC 1: TYPING LOGIC
        function initTyping() {
            currentWords = Array.from({length: 100}, () => dictionary[Math.floor(Math.random() * dictionary.length)]);
            currentIndex = 0;
            correctChars = 0;
            renderWords('word-display', currentWords);
        }

        function renderWords(containerId, wordArr) {
            const container = document.getElementById(containerId);
            container.innerHTML = wordArr.map((w, i) => `<span class="word" id="w-${containerId}-${i}">${w}</span>`).join('');
            document.getElementById(`w-${containerId}-0`).classList.add('current');
        }

        document.getElementById('typing-input').addEventListener('input', function(e) {
            if(!timer && this.value.length > 0) startTimer();
            if(this.value.endsWith(' ')) {
                const typed = this.value.trim();
                const wordEl = document.getElementById(`w-word-display-${currentIndex}`);
                if(typed === currentWords[currentIndex]) {
                    wordEl.classList.add('correct');
                    correctChars += typed.length + 1;
                } else {
                    wordEl.classList.add('incorrect');
                }
                wordEl.classList.remove('current');
                currentIndex++;
                document.getElementById(`w-word-display-${currentIndex}`).classList.add('current');
                this.value = '';
            }
        });

        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    saveScore();
                    alert("Hết giờ! WPM của bạn: " + Math.round((correctChars/5)/(30/60)));
                    resetTyping();
                }
            }, 1000);
        }

        function resetTyping() {
            clearInterval(timer);
            timer = null;
            timeLeft = 30;
            document.getElementById('timer').innerText = "30";
            document.getElementById('typing-input').value = "";
            initTyping();
        }

        // MỤC 3: TOP 100
        function saveScore() {
            let scores = JSON.parse(localStorage.getItem('scores')) || [];
            const wpm = Math.round((correctChars/5)/(30/60));
            scores.push({ name: currentUser.username, wpm: wpm, date: new Date().toLocaleDateString() });
            scores.sort((a,b) => b.wpm - a.wpm);
            localStorage.setItem('scores', JSON.stringify(scores.slice(0, 100)));
            updateLeaderboard();
        }

        function updateLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('scores')) || [];
            const tbody = document.querySelector('#leaderboard tbody');
            tbody.innerHTML = scores.map((s, i) => `<tr><td>${i+1}</td><td>${s.name}</td><td>${s.wpm}</td><td>${s.date}</td></tr>`).join('');
        }

        // MỤC 4: CHIA SẺ
        function publishText() {
            const txt = document.getElementById('share-text-input').value;
            if(!txt) return;
            let shares = JSON.parse(localStorage.getItem('shares')) || [];
            shares.unshift({ user: currentUser.username, content: txt });
            localStorage.setItem('shares', JSON.stringify(shares));
            renderShares();
        }

        function renderShares() {
            const shares = JSON.parse(localStorage.getItem('shares')) || [];
            document.getElementById('shared-list').innerHTML = shares.map(s => `
                <div class="hand-card" style="margin-bottom:10px">
                    <p><b>${s.user}</b> đã chia sẻ:</p>
                    <p>${s.content.substring(0, 50)}...</p>
                    <button class="btn" onclick="startTypingSpecific('${s.content.replace(/'/g, "\\'")}')">Gõ thử</button>
                </div>
            `).join('');
        }
        function startTypingSpecific(text) {
            dictionary = text.split(' ');
            switchTab('tab-1');
        }

        // MỤC 5: TÙY CHỈNH
        function saveCustomConfig() {
            const raw = document.getElementById('config-words-raw').value;
            localStorage.setItem('custom_dict', raw);
            closeModals();
            initCustomTyping();
        }

        function initCustomTyping() {
            const customDict = (localStorage.getItem('custom_dict') || "tôi|yêu|lập|trình").split('|');
            const customWords = Array.from({length: 50}, () => customDict[Math.floor(Math.random() * customDict.length)]);
            renderWords('custom-word-display', customWords);
        }

        // UTILS
        function showModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
        function changePassword() {
            const np = document.getElementById('new-pw').value;
            if(np) {
                currentUser.password = np;
                localStorage.setItem('typing_user', JSON.stringify(currentUser));
                alert("Đã đổi mật khẩu!");
            }
        }

        window.onload = () => {
            updateUI();
            initTyping();
            renderShares();
        };
    </script>
</body>
</html>
