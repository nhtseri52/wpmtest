<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Master Pro - Admin Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #4a90e2; --bg: #f4f7f9; --text: #333; --success: #5cb85c; --error: #d9534f; --gray: #999; --admin: #f39c12; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text); }
        .main-container { display: flex; gap: 20px; max-width: 1250px; margin: auto; }

        /* Sidebar */
        .sidebar { width: 280px; flex-shrink: 0; }
        .menu-card { background: white; border-radius: 6px; border: 1px solid #ddd; margin-bottom: 15px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .menu-item { padding: 12px 15px; display: flex; align-items: center; cursor: pointer; border-bottom: 1px solid #eee; transition: 0.2s; font-size: 14px; color: #444; }
        .menu-item:hover { background: #f8f9fa; }
        .menu-item.active { background: var(--primary); color: white; border-bottom: none; }
        .menu-item i { width: 25px; font-size: 16px; margin-right: 10px; }
        
        .admin-badge { border: 1px solid var(--admin); color: var(--admin); font-size: 10px; padding: 1px 4px; border-radius: 3px; margin-left: auto; font-weight: bold; text-transform: uppercase; }

        /* Content Area */
        .content { flex-grow: 1; background: white; padding: 25px; border-radius: 6px; border: 1px solid #ddd; min-height: 600px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* Typing Box */
        .word-wrapper { background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 15px; font-size: 24px; line-height: 1.6; height: 100px; overflow: hidden; position: relative; margin-bottom: 20px; }
        #word-display { display: flex; flex-wrap: wrap; gap: 12px; transition: transform 0.3s ease; }
        .word { padding: 2px 5px; color: #666; border-radius: 3px; transition: 0.1s; }
        .word.current { background: #dddddd; color: #000; }
        .word.correct { color: var(--success); }
        .word.incorrect { background: var(--error); color: white; }

        .input-bar { display: flex; gap: 10px; align-items: center; background: #f1f3f5; padding: 15px; border-radius: 4px; }
        #typing-input { flex: 1; padding: 12px; font-size: 20px; border: 1px solid #ced4da; border-radius: 4px; outline: none; }
        #timer-box { background: var(--primary); color: white; padding: 10px 20px; font-weight: bold; font-size: 24px; border-radius: 4px; min-width: 60px; text-align: center; }

        /* Tables */
        .share-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .share-table th { text-align: left; padding: 12px; border-bottom: 2px solid #eee; color: #888; font-size: 13px; text-transform: uppercase; }
        .share-table td { padding: 12px; border-bottom: 1px solid #f1f1f1; font-size: 14px; }
        .btn-action { background: var(--primary); color: white; border: none; padding: 10px 18px; border-radius: 4px; cursor: pointer; font-weight: bold; }

        /* Modals */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:9999; }
        .modal-box { background:white; padding:30px; border-radius:8px; width:450px; text-align: center; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="sidebar">
            <div id="user-menu" class="menu-card">
                <div class="menu-item active" id="m-1" onclick="switchTab('tab-1')"><i class="fa-solid fa-keyboard"></i> M·ª•c 1: T·∫≠p ƒë√°nh m√°y</div>
                <div class="menu-item" id="m-3" onclick="switchTab('tab-3')"><i class="fa-solid fa-trophy"></i> M·ª•c 3: Top 100</div>
                <div class="menu-item" id="m-4" onclick="switchTab('tab-4')"><i class="fa-solid fa-share-nodes"></i> M·ª•c 4: Chia s·∫ª vƒÉn b·∫£n</div>
            </div>

            <div id="admin-menu" class="menu-card hidden">
                <div class="menu-item" id="m-admin" onclick="switchTab('tab-admin')"><i class="fa-solid fa-user-shield"></i> [Qu·∫£n l√Ω User]</div>
            </div>

            <div id="profile-menu" class="menu-card">
                <div class="menu-item" id="m-p" onclick="switchTab('tab-profile')"><i class="fa-solid fa-user-circle"></i> H·ªì s∆°</div>
                <div class="menu-item" style="color:var(--error)" onclick="logout()"><i class="fa-solid fa-power-off"></i> ƒêƒÉng xu·∫•t</div>
            </div>
        </div>

        <div class="content">
            <div id="tab-1" class="tab-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                    <h3 id="typing-title" style="margin:0">T·∫≠p ƒë√°nh m√°y (VƒÉn b·∫£n ng·∫´u nhi√™n)</h3>
                    <div>
                        <button class="btn-action" style="padding:5px 10px" onclick="changeLimit(30)">30s</button>
                        <button class="btn-action" style="padding:5px 10px" onclick="changeLimit(60)">60s</button>
                    </div>
                </div>
                <div class="word-wrapper"><div id="word-display"></div></div>
                <div class="input-bar">
                    <input type="text" id="typing-input" placeholder="G√µ t·∫°i ƒë√¢y..." autofocus autocomplete="off">
                    <div id="timer-box">30</div>
                    <button class="btn-action" onclick="resetGame()"><i class="fa-solid fa-sync"></i></button>
                </div>
            </div>

            <div id="tab-3" class="tab-content hidden">
                <h2>B·∫£ng x·∫øp h·∫°ng (K·ª∑ l·ª•c cao nh·∫•t)</h2>
                <table class="share-table">
                    <thead>
                        <tr>
                            <th>H·∫°ng</th>
                            <th>Th√†nh vi√™n</th>
                            <th>WPM</th>
                            <th>Ch·∫ø ƒë·ªô</th>
                            <th>Ng√†y ƒë·∫°t ƒë∆∞·ª£c</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body"></tbody>
                </table>
            </div>

            <div id="tab-4" class="tab-content hidden">
                <button class="btn-action" style="float:right; background:var(--success)" onclick="openModal('modal-create')">T·∫°o vƒÉn b·∫£n</button>
                <h2>VƒÉn b·∫£n c·ªông ƒë·ªìng</h2>
                <table class="share-table">
                    <thead><tr><th>Tr·∫°ng th√°i</th><th>Ti√™u ƒë·ªÅ</th><th>ƒê·ªô d√†i</th><th>Ng√†y t·∫°o</th></tr></thead>
                    <tbody id="share-tbody"></tbody>
                </table>
            </div>

            <div id="tab-admin" class="tab-content hidden">
                <h2>Qu·∫£n l√Ω ng∆∞·ªùi d√πng (D√†nh cho Admin)</h2>
                <table class="share-table">
                    <thead><tr><th>User</th><th>Password</th><th>Gmail</th><th>H√†nh ƒë·ªông</th></tr></thead>
                    <tbody id="admin-user-list"></tbody>
                </table>
            </div>

            <div id="tab-profile" class="tab-content hidden">
                <h2>H·ªì s∆° c√° nh√¢n</h2>
                <div id="prof-data" style="background:#f9f9f9; padding:20px; border-radius:8px"></div>
            </div>
        </div>
    </div>

    <div id="modal-auth" class="modal">
        <div class="modal-box">
            <div style="display:flex; gap:10px; margin-bottom:20px">
                <button id="auth-tab-l" class="btn-action" style="flex:1" onclick="setAuthMode('login')">ƒêƒÉng nh·∫≠p</button>
                <button id="auth-tab-r" class="btn-action" style="flex:1; background:#999" onclick="setAuthMode('reg')">ƒêƒÉng k√Ω</button>
            </div>
            <input type="text" id="au" placeholder="T√™n t√†i kho·∫£n">
            <div id="reg-fields" class="hidden">
                <input type="email" id="ae" placeholder="Gmail">
            </div>
            <input type="password" id="ap" placeholder="M·∫≠t kh·∫©u">
            <button class="btn-action" style="width:100%; margin-top:10px" onclick="handleAuth()">X√°c nh·∫≠n</button>
        </div>
    </div>

    <div id="modal-res" class="modal">
        <div class="modal-box">
            <h2 style="color:var(--primary)">K·∫æT QU·∫¢</h2>
            <div style="font-size: 45px; font-weight: bold;" id="res-wpm">0 WPM</div>
            <p id="res-msg"></p>
            <hr>
            <p>H·∫°ng c·ªßa b·∫°n: <span id="res-rank" style="font-weight:bold">...</span></p>
            <button class="btn-action" onclick="closeModal('modal-res'); resetGame();">G√µ l·∫°i</button>
        </div>
    </div>

    <div id="modal-create" class="modal">
        <div class="modal-box">
            <h3>ƒêƒÉng vƒÉn b·∫£n m·ªõi</h3>
            <input type="text" id="share-title" placeholder="Ti√™u ƒë·ªÅ...">
            <textarea id="share-content" rows="5" placeholder="N·ªôi dung vƒÉn b·∫£n..."></textarea>
            <button class="btn-action" style="width:100%" onclick="saveShare()">ƒêƒÉng c√¥ng khai</button>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        const ADMIN_INFO = { u: "nhtseri", e: "nhtseri52@gmail.com", p: "Locthinh52!" };
        const DICT = "anh|em|h·ªçc|sinh|tr∆∞·ªùng|chuy√™n|nghi·ªáp|l·∫≠p|tr√¨nh|th√¥ng|tin|th√†nh|c√¥ng|n·ªó|l·ª±c|ph√°t|tri·ªÉn|s√°ng|t·∫°o|vui|v·∫ª|m·∫°nh|kh·ªèe|gi√≥|s∆∞|ph·∫°m|k√≠nh|g·ª≠i|ƒë·∫•t|th∆°".split('|');

        let user = JSON.parse(localStorage.getItem('typing_user')) || null;
        let authMode = 'login';
        let timeLimit = 30;
        let timeLeft = 30;
        let timer = null;
        let currentWords = [];
        let curIdx = 0;
        let corrects = 0;

        // --- AUTH LOGIC ---
        function setAuthMode(m) {
            authMode = m;
            document.getElementById('auth-tab-l').style.background = m === 'login' ? '#4a90e2' : '#999';
            document.getElementById('auth-tab-r').style.background = m === 'reg' ? '#4a90e2' : '#999';
            document.getElementById('reg-fields').classList.toggle('hidden', m === 'login');
        }

        function handleAuth() {
            const u = document.getElementById('au').value.trim();
            const p = document.getElementById('ap').value.trim();
            const e = document.getElementById('ae').value.trim();

            if (!u || !p) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß!");

            // Ki·ªÉm tra Admin
            if (u === ADMIN_INFO.u || e === ADMIN_INFO.e) {
                if (p === ADMIN_INFO.p) {
                    return loginSuccess({ u: ADMIN_INFO.u, e: ADMIN_INFO.e, isAdmin: true });
                }
            }

            if (authMode === 'login') {
                const acc = JSON.parse(localStorage.getItem('acc_' + u));
                if (acc && acc.p === p) loginSuccess({ u: u, e: acc.e, isAdmin: false });
                else alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
            } else {
                if (!e) return alert("Vui l√≤ng nh·∫≠p Gmail!");
                
                // Ki·ªÉm tra tr√πng t√™n
                if (localStorage.getItem('acc_' + u)) return alert("T√™n ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t!");
                
                // Ki·ªÉm tra tr√πng Gmail
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('acc_')) {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (data.e === e) return alert("Gmail ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!");
                    }
                }

                localStorage.setItem('acc_' + u, JSON.stringify({ p: p, e: e, date: new Date().toLocaleDateString() }));
                alert("ƒêƒÉng k√Ω th√†nh c√¥ng!");
                setAuthMode('login');
            }
        }

        function loginSuccess(obj) {
            localStorage.setItem('typing_user', JSON.stringify(obj));
            location.reload();
        }

        function logout() { localStorage.removeItem('typing_user'); location.reload(); }

        // --- TYPING ENGINE ---
        function resetGame() {
            clearInterval(timer); timer = null;
            timeLeft = timeLimit;
            curIdx = 0; corrects = 0;
            document.getElementById('timer-box').innerText = timeLeft;
            document.getElementById('typing-input').value = "";
            
            if(currentWords.length === 0) {
                currentWords = Array.from({length: 100}, () => DICT[Math.floor(Math.random() * DICT.length)]);
            }
            
            document.getElementById('word-display').innerHTML = currentWords.map((w, i) => `<span class="word" id="w-${i}">${w}</span>`).join('');
            document.getElementById('w-0').classList.add('current');
            document.getElementById('word-display').style.transform = "translateY(0)";
            document.getElementById('typing-input').focus();
        }

        document.getElementById('typing-input').addEventListener('input', function() {
            if (!timer) {
                timer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer-box').innerText = timeLeft;
                    if (timeLeft <= 0) finish();
                }, 1000);
            }

            if (this.value.endsWith(' ')) {
                const typed = this.value.trim();
                const el = document.getElementById(`w-${curIdx}`);
                if (typed === currentWords[curIdx]) {
                    el.classList.add('correct'); corrects++;
                } else el.classList.add('incorrect');

                el.classList.remove('current');
                curIdx++;
                const next = document.getElementById(`w-${curIdx}`);
                if (next) {
                    next.classList.add('current');
                    if (next.offsetTop > 45) {
                        document.getElementById('word-display').style.transform = `translateY(-${next.offsetTop - 10}px)`;
                    }
                }
                this.value = "";
            }
        });

        function finish() {
            clearInterval(timer);
            const wpm = Math.round(corrects / (timeLimit / 60));
            
            // L∆∞u k·ª∑ l·ª•c
            let scores = JSON.parse(localStorage.getItem('typing_scores') || "[]");
            let myIdx = scores.findIndex(s => s.u === user.u);
            let isNew = false;
            
            const data = { u: user.u, wpm: wpm, mode: timeLimit + "s", date: new Date().toLocaleString() };
            
            if (myIdx === -1) { scores.push(data); isNew = true; }
            else if (wpm > scores[myIdx].wpm) { scores[myIdx] = data; isNew = true; }
            
            scores.sort((a,b) => b.wpm - a.wpm);
            localStorage.setItem('typing_scores', JSON.stringify(scores));

            document.getElementById('res-wpm').innerText = wpm + " WPM";
            document.getElementById('res-msg').innerText = isNew ? "üéâ K·ª∂ L·ª§C M·ªöI!" : "C·ªë g·∫Øng h∆°n l·∫ßn sau nh√©!";
            document.getElementById('res-rank').innerText = scores.findIndex(s => s.u === user.u) + 1;
            openModal('modal-res');
        }

        // --- TABS ---
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'tab-3') renderLeaderboard();
            if(id === 'tab-admin') renderAdmin();
            if(id === 'tab-profile') renderProfile();
        }

        function renderLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('typing_scores') || "[]");
            document.getElementById('leaderboard-body').innerHTML = scores.map((s, i) => `
                <tr>
                    <td>${i+1}</td>
                    <td>${s.u} ${s.u === 'nhtseri' ? '<span class="admin-badge">Admin</span>' : ''}</td>
                    <td style="font-weight:bold; color:var(--primary)">${s.wpm}</td>
                    <td>${s.mode}</td>
                    <td><small>${s.date}</small></td>
                </tr>
            `).join('');
        }

        function renderAdmin() {
            let html = '';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('acc_')) {
                    const d = JSON.parse(localStorage.getItem(key));
                    html += `<tr><td>${key.replace('acc_','')}</td><td>${d.p}</td><td>${d.e}</td><td><button onclick="deleteAcc('${key}')">X√≥a</button></td></tr>`;
                }
            }
            document.getElementById('admin-user-list').innerHTML = html;
        }

        function renderProfile() {
            document.getElementById('prof-data').innerHTML = `
                <p><strong>T√†i kho·∫£n:</strong> ${user.u} ${user.isAdmin ? '<span class="admin-badge">Admin Account</span>' : ''}</p>
                <p><strong>Gmail:</strong> ${user.e}</p>
                <button class="btn-action" style="background:var(--error)" onclick="logout()">ƒêƒÉng xu·∫•t ngay</button>
            `;
        }

        function saveShare() {
            const t = document.getElementById('share-title').value;
            const c = document.getElementById('share-content').value;
            if(!t || !c) return alert("Thi·∫øu th√¥ng tin!");
            
            let shares = JSON.parse(localStorage.getItem('typing_shares') || "[]");
            shares.unshift({ id: Date.now(), title: t, content: c, date: "V·ª´a xong" });
            localStorage.setItem('typing_shares', JSON.stringify(shares));
            closeModal('modal-create');
            renderShares();
        }

        function renderShares() {
            let shares = JSON.parse(localStorage.getItem('typing_shares') || "[]");
            document.getElementById('share-tbody').innerHTML = shares.map(s => `
                <tr>
                    <td><span style="color:green">‚óè C√¥ng khai</span></td>
                    <td><a href="#" onclick="loadContent(${s.id})" style="color:var(--primary); font-weight:bold">${s.title}</a></td>
                    <td>${s.content.split(' ').length} t·ª´</td>
                    <td>${s.date}</td>
                </tr>
            `).join('');
        }

        function loadContent(id) {
            let shares = JSON.parse(localStorage.getItem('typing_shares') || "[]");
            let item = shares.find(x => x.id === id);
            currentWords = item.content.split(' ');
            document.getElementById('typing-title').innerText = "ƒêang g√µ: " + item.title;
            switchTab('tab-1');
            resetGame();
        }

        // --- UTILS ---
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function changeLimit(s) { timeLimit = s; resetGame(); }

        window.onload = () => {
            if (!user) openModal('modal-auth');
            else {
                if (user.isAdmin) document.getElementById('admin-menu').classList.remove('hidden');
                resetGame();
                renderShares();
            }
        };
    </script>
</body>
</html>
