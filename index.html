<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Đánh Máy Chuyên Nghiệp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #2980b9; --bg: #ecf0f1; --gold: #f1c40f; --dark: #2c3e50; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; padding: 20px; gap: 20px; margin: 0; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 300px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; }
        .card { background: white; border-radius: 10px; border: 1px solid #ddd; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; }
        .nav-item { padding: 15px; display: flex; align-items: center; text-decoration: none; color: #555; border-bottom: 1px solid #f1f1f1; cursor: pointer; transition: 0.2s; }
        .nav-item:hover { background: #f9f9f9; }
        .nav-item.active { background: var(--primary); color: white; border: none; }
        .nav-item i { width: 30px; font-size: 18px; }

        /* Admin Highlight */
        .admin-border { border: 3px solid var(--gold) !important; position: relative; }
        .admin-badge { background: var(--gold); color: black; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-left: auto; }
        .admin-stats { background: var(--dark) !important; color: white; padding: 20px; text-align: center; }
        
        /* Main Content */
        .main-content { flex-grow: 1; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-y: auto; }
        .page { display: none; }
        .page.active { display: block; }

        /* Typing Area chuẩn ảnh bạn gửi */
        .typing-container { background: #adcce9; padding: 20px; border-radius: 8px; display: flex; gap: 10px; align-items: center; margin-top: 20px; }
        #input-box { flex-grow: 1; height: 50px; padding: 10px 15px; font-size: 24px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
        .timer-box { background: #34495e; color: white; padding: 0 20px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 24px; border-radius: 4px; min-width: 80px; }
        .reset-btn { background: #4a90e2; color: white; border: none; height: 50px; width: 60px; border-radius: 4px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; }
        
        .word-display { font-size: 28px; line-height: 1.6; margin-bottom: 20px; min-height: 100px; color: #999; }
        .word-active { background: #eee; color: #000; border-radius: 4px; padding: 0 5px; }
        .word-correct { color: #27ae60; }
        .word-wrong { background: #e74c3c; color: white; border-radius: 4px; padding: 0 5px; }

        /* Admin Table */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .btn-edit { background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        
        /* Auth Overlay */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .auth-box { background: white; padding: 40px; border-radius: 15px; width: 380px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .auth-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box">
            <h2 style="text-align:center">Đăng nhập / Đăng ký</h2>
            <input type="text" id="reg-u" placeholder="Tên người dùng">
            <input type="email" id="reg-e" placeholder="Email (Admin: nhtseri52@gmail.com)">
            <input type="password" id="reg-p" placeholder="Mật khẩu">
            <button onclick="app.login()" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold">VÀO HỆ THỐNG</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar-inject"></div>

    <div class="main-content">
        <div id="page-typing" class="page active">
            <h2>Luyện tập gõ phím</h2>
            <div id="word-display" class="word-display"></div>
            <div class="typing-container">
                <input type="text" id="input-box" placeholder="Gõ tại đây..." autocomplete="off">
                <div id="timer" class="timer-box">1:00</div>
                <button class="reset-btn" onclick="app.resetTyping()"><i class="fa-solid fa-rotate-right"></i></button>
            </div>
        </div>

        <div id="page-rank" class="page"><h2>Bảng xếp hạng</h2><div id="rank-list"></div></div>
        
        <div id="page-admin" class="page">
            <h2 style="color:#e67e22"><i class="fa-solid fa-user-shield"></i> Quản lý hệ thống (GOD MODE)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tên User</th>
                        <th>Email</th>
                        <th>Mật khẩu</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody id="admin-user-list"></tbody>
            </table>
        </div>
    </div>

    <script>
        const ADMIN_EMAIL = "nhtseri52@gmail.com";

        const app = {
            user: null,
            words: "trường học đánh máy chuyên nghiệp tương lai công nghệ nỗ lực thành công sáng tạo".split(" "),
            curIdx: 0,
            timeLeft: 60,
            timer: null,
            isPlaying: false,

            init() {
                const saved = localStorage.getItem('user');
                if (saved) {
                    this.user = JSON.parse(saved);
                    document.getElementById('auth-screen').style.display = 'none';
                    this.renderSidebar();
                    this.resetTyping();
                }
            },

            login() {
                const u = document.getElementById('reg-u').value;
                const e = document.getElementById('reg-e').value;
                const p = document.getElementById('reg-p').value;
                if (!u || !e || !p) return alert("Vui lòng nhập đủ thông tin!");

                this.user = { u, e, isAdmin: e === ADMIN_EMAIL };
                localStorage.setItem('user', JSON.stringify(this.user));
                localStorage.setItem(`acc_${u}`, JSON.stringify({ e, p }));
                
                document.getElementById('auth-screen').style.display = 'none';
                this.renderSidebar();
                this.resetTyping();
            },

            renderSidebar() {
                const isAdmin = this.user.isAdmin;
                let html = `
                    <div class="card ${isAdmin ? 'admin-border' : ''}">
                        <div class="nav-item" style="flex-direction:column; align-items:flex-start">
                            <div style="display:flex; width:100%; align-items:center">
                                <b>${this.user.u}</b>
                                ${isAdmin ? '<span class="admin-badge">CHỦ WEB</span>' : ''}
                            </div>
                            <small style="color:#888">${this.user.e}</small>
                        </div>
                        <div class="nav-item" style="color:#e74c3c" onclick="app.logout()">
                            <i class="fa-solid fa-power-off"></i> Đăng xuất
                        </div>
                    </div>
                    ${isAdmin ? `
                    <div class="card admin-stats">
                        <small>ONLINE USERS</small>
                        <div style="font-size:32px; color:var(--gold); font-weight:bold">${Math.floor(Math.random()*20)+5}</div>
                    </div>` : ''}
                    <div class="card">
                        <div class="nav-item active" onclick="app.showPage('typing')"><i class="fa-solid fa-keyboard"></i> Mục 1: Tập gõ</div>
                        <div class="nav-item" onclick="app.showPage('rank')"><i class="fa-solid fa-trophy"></i> Mục 3: Xếp hạng</div>
                        ${isAdmin ? `<div class="nav-item" style="background:#fff3cd" onclick="app.showPage('admin')"><i class="fa-solid fa-user-shield"></i> GOD MODE</div>` : ''}
                    </div>
                `;
                document.getElementById('sidebar-inject').innerHTML = html;
            },

            showPage(id) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('page-' + id).classList.add('active');
                if(id === 'admin') this.renderAdminList();
            },

            resetTyping() {
                clearInterval(this.timer);
                this.timeLeft = 60;
                this.curIdx = 0;
                this.isPlaying = false;
                document.getElementById('timer').innerText = "1:00";
                document.getElementById('input-box').value = "";
                document.getElementById('input-box').disabled = false;
                this.renderWords();
            },

            renderWords() {
                const container = document.getElementById('word-display');
                container.innerHTML = this.words.map((w, i) => 
                    `<span id="word-${i}" class="${i === 0 ? 'word-active' : ''}">${w}</span>`
                ).join(" ");
            },

            startTimer() {
                this.timer = setInterval(() => {
                    this.timeLeft--;
                    let m = Math.floor(this.timeLeft / 60);
                    let s = this.timeLeft % 60;
                    document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                    if (this.timeLeft <= 0) this.endGame();
                }, 1000);
            },

            endGame() {
                clearInterval(this.timer);
                document.getElementById('input-box').disabled = true;
                alert("Hết giờ!");
            },

            renderAdminList() {
                const list = document.getElementById('admin-user-list');
                list.innerHTML = "";
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('acc_')) {
                        const uName = key.replace('acc_', '');
                        const data = JSON.parse(localStorage.getItem(key));
                        list.innerHTML += `
                            <tr>
                                <td><b>${uName}</b></td>
                                <td>${data.e}</td>
                                <td><input type="text" id="edit-p-${uName}" value="${data.p}" style="padding:5px"></td>
                                <td><button class="btn-edit" onclick="app.updatePass('${uName}', '${data.e}')">Lưu mật khẩu mới</button></td>
                            </tr>
                        `;
                    }
                }
            },

            updatePass(u, e) {
                const newP = document.getElementById(`edit-p-${u}`).value;
                localStorage.setItem(`acc_${u}`, JSON.stringify({ e: e, p: newP }));
                alert(`Đã đổi mật khẩu cho ${u} thành công!`);
                this.renderAdminList();
            },

            logout() {
                localStorage.removeItem('user');
                location.reload();
            }
        };

        // Xử lý sự kiện gõ phím
        document.getElementById('input-box').addEventListener('input', function(e) {
            if (!app.isPlaying) {
                app.isPlaying = true;
                app.startTimer();
            }
            if (this.value.endsWith(" ")) {
                const typed = this.value.trim();
                const currentEl = document.getElementById(`word-${app.curIdx}`);
                
                if (typed === app.words[app.curIdx]) {
                    currentEl.className = "word-correct";
                } else {
                    currentEl.className = "word-wrong";
                }

                app.curIdx++;
                if (app.curIdx < app.words.length) {
                    document.getElementById(`word-${app.curIdx}`).className = "word-active";
                } else {
                    app.endGame();
                }
                this.value = "";
            }
        });

        window.onload = () => app.init();
    </script>
</body>
</html>
