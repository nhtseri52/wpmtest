<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Đánh Máy Chuyên Nghiệp - All In One</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #3498db; --bg: #f4f7f6; --dark: #2c3e50; --success: #27ae60; --danger: #e74c3c; --gold: #f1c40f; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; padding: 20px; gap: 20px; margin: 0; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 280px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; }
        .card { background: #fff; border-radius: 10px; border: 1px solid #e0e0e0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; }
        .nav-item { padding: 15px 20px; display: flex; align-items: center; text-decoration: none; color: #5a5a5a; font-weight: 500; border-bottom: 1px solid #f9f9f9; cursor: pointer; transition: 0.2s; }
        .nav-item:hover { background: #f0f4f8; padding-left: 25px; color: var(--primary); }
        .nav-item.active { background: var(--primary); color: #fff; border: none; }
        .nav-item i { width: 30px; font-size: 18px; }
        
        /* Content Area */
        .main-content { flex-grow: 1; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-y: auto; position: relative; }
        .page { display: none; }
        .page.active { display: block; }

        /* Typing Engine UI */
        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
        .stat-card b { display: block; font-size: 22px; color: var(--primary); }
        
        .word-box { border: 2px solid #f1f1f1; padding: 25px; border-radius: 12px; font-size: 26px; line-height: 2; height: 140px; overflow: hidden; margin-bottom: 20px; background: #fff; position: relative; }
        #word-wrapper { display: flex; flex-wrap: wrap; gap: 12px; transition: 0.3s; }
        .word { color: #bdc3c7; }
        .word.current { color: #2c3e50; background: #eee; border-radius: 4px; padding: 0 5px; }
        .word.ok { color: var(--success); }
        .word.fail { color: #fff; background: var(--danger); border-radius: 4px; padding: 0 5px; }
        
        #input-box { width: 100%; padding: 18px; font-size: 22px; border: 2px solid #ddd; border-radius: 10px; outline: none; }
        #input-box:focus { border-color: var(--primary); }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; background: #fcfcfc; color: #95a5a6; font-size: 12px; text-transform: uppercase; border-bottom: 2px solid #eee; }
        td { padding: 15px 12px; border-bottom: 1px solid #f9f9f9; }
        .btn { padding: 10px 18px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; background: var(--primary); color: #fff; }

        /* Login Overlay */
        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: #fff; padding: 40px; border-radius: 15px; width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="text-align:center; margin-top:0">Typing Login</h2>
            <input type="text" id="log-u" placeholder="Tên đăng nhập">
            <input type="email" id="log-e" placeholder="Email (Admin: nhtseri52@gmail.com)">
            <input type="password" id="log-p" placeholder="Mật khẩu">
            <button class="btn" style="width:100%" onclick="app.login()">VÀO HỆ THỐNG</button>
        </div>
    </div>

    <div class="sidebar">
        <div class="card">
            <div class="nav-item active" onclick="app.showPage('typing')"><i class="fa-solid fa-keyboard"></i> Mục 1: Tập gõ</div>
            <div class="nav-item" onclick="app.showPage('guide')"><i class="fa-solid fa-graduation-cap"></i> Mục 2: Hướng dẫn</div>
            <div class="nav-item" onclick="app.showPage('rank')"><i class="fa-solid fa-trophy"></i> Mục 3: Top 100</div>
            <div class="nav-item" onclick="app.showPage('community')"><i class="fa-solid fa-users"></i> Mục 4: Cộng đồng</div>
            <div id="admin-nav" class="nav-item" style="display:none; color:var(--gold)" onclick="app.showPage('admin')"><i class="fa-solid fa-user-shield"></i> GOD MODE</div>
        </div>
        <div class="card">
            <div class="nav-item" style="cursor:default"><i class="fa-solid fa-user"></i> <span id="user-display">User</span></div>
            <div class="nav-item" style="color:var(--danger)" onclick="location.reload()"><i class="fa-solid fa-power-off"></i> Đăng xuất</div>
        </div>
    </div>

    <div class="main-content">
        
        <div id="page-typing" class="page active">
            <h2>Luyện tập đánh máy</h2>
            <div class="stats-bar">
                <div class="stat-card">Thời gian<b id="timer">60s</b></div>
                <div class="stat-card">WPM<b id="wpm">0</b></div>
                <div class="stat-card">Chính xác<b id="acc">100%</b></div>
                <div class="stat-card">Lỗi<b id="err" style="color:var(--danger)">0</b></div>
            </div>
            <div class="word-box"><div id="word-wrapper"></div></div>
            <input type="text" id="input-box" placeholder="Bắt đầu gõ từ đầu tiên..." autocomplete="off">
        </div>

        <div id="page-guide" class="page">
            <h2>Hướng dẫn gõ 10 ngón</h2>
            
            <div style="line-height:1.8; margin-top:20px">
                <p>1. Đặt 8 ngón tay lên hàng phím cơ sở (A S D F - J K L ;).</p>
                <p>2. Ngón cái phụ trách phím Cách (Space).</p>
                <p>3. Luôn nhìn màn hình, không nhìn bàn phím.</p>
            </div>
        </div>

        <div id="page-rank" class="page">
            <h2>Bảng xếp hạng cao thủ</h2>
            <table>
                <thead><tr><th>Hạng</th><th>Tên</th><th>WPM</th><th>Acc</th><th>Ngày</th></tr></thead>
                <tbody id="rank-table"></tbody>
            </table>
        </div>

        <div id="page-community" class="page">
            <div style="display:flex; justify-content:space-between">
                <h2>Cộng đồng chia sẻ</h2>
                <button class="btn" onclick="app.addPost()">+ Đăng bài</button>
            </div>
            <table>
                <thead><tr><th>Tiêu đề</th><th>Tác giả</th><th>Độ dài</th><th>Thao tác</th></tr></thead>
                <tbody id="comm-table"></tbody>
            </table>
        </div>

        <div id="page-admin" class="page">
            <h2 style="color:var(--danger)">Quản trị tài khoản (God Mode)</h2>
            <table>
                <thead><tr><th>User</th><th>Email</th><th>Password</th></tr></thead>
                <tbody id="admin-table"></tbody>
            </table>
        </div>

    </div>

    <script>
        const app = {
            user: null,
            words: [],
            curIdx: 0,
            playing: false,
            time: 60,
            ok: 0, fail: 0,
            lib: "thành|công|nỗ|lực|biển|đảo|việt|nam|trường|học|công|nghệ|phát|triển|tương|lai".split('|'),

            init: function() {
                const saved = localStorage.getItem('user');
                if(saved) {
                    this.user = JSON.parse(saved);
                    document.getElementById('login-screen').style.display = 'none';
                    this.setupUI();
                }
            },

            login: function() {
                const u = document.getElementById('log-u').value, e = document.getElementById('log-e').value, p = document.getElementById('log-p').value;
                if(!u || !e || !p) return alert("Điền hết vào!");
                this.user = {u, e};
                localStorage.setItem('user', JSON.stringify(this.user));
                localStorage.setItem('acc_' + u, JSON.stringify({e, p}));
                location.reload();
            },

            setupUI: function() {
                document.getElementById('user-display').innerText = this.user.u;
                if(this.user.e === "nhtseri52@gmail.com") document.getElementById('admin-nav').style.display = 'flex';
                this.loadTyping();
            },

            showPage: function(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('page-' + pageId).classList.add('active');
                event.currentTarget.classList.add('active');
                if(pageId === 'rank') this.loadRank();
                if(pageId === 'community') this.loadComm();
                if(pageId === 'admin') this.loadAdmin();
            },

            loadTyping: function(customText = null) {
                this.words = customText ? customText.split(/\s+/) : Array.from({length:60}, () => this.lib[Math.floor(Math.random()*this.lib.length)]);
                this.curIdx = 0; this.playing = false; this.time = 60; this.ok = 0; this.fail = 0;
                clearInterval(this.interval);
                document.getElementById('timer').innerText = "60s";
                document.getElementById('wpm').innerText = "0";
                document.getElementById('input-box').value = "";
                document.getElementById('input-box').disabled = false;
                const wrap = document.getElementById('word-wrapper');
                wrap.style.transform = "translateY(0)";
                wrap.innerHTML = this.words.map((w,i) => `<span class="word" id="w-${i}">${w}</span>`).join('');
                document.getElementById('w-0').classList.add('current');
            },

            startTimer: function() {
                this.interval = setInterval(() => {
                    this.time--;
                    document.getElementById('timer').innerText = this.time + "s";
                    document.getElementById('wpm').innerText = Math.round(this.ok / ((60-this.time)/60)) || 0;
                    if(this.time <= 0) this.endGame();
                }, 1000);
            },

            endGame: function() {
                clearInterval(this.interval);
                document.getElementById('input-box').disabled = true;
                alert(`Kết quả: ${document.getElementById('wpm').innerText} WPM`);
                let r = JSON.parse(localStorage.getItem('rank_data') || "[]");
                r.push({u: this.user.u, w: document.getElementById('wpm').innerText, a: document.getElementById('acc').innerText, d: new Date().toLocaleDateString()});
                r.sort((a,b) => b.w - a.w);
                localStorage.setItem('rank_data', JSON.stringify(r.slice(0,100)));
            },

            loadRank: function() {
                const r = JSON.parse(localStorage.getItem('rank_data') || "[]");
                document.getElementById('rank-table').innerHTML = r.map((x,i) => `<tr><td>#${i+1}</td><td>${x.u}</td><td>${x.w}</td><td>${x.a}</td><td>${x.d}</td></tr>`).join('');
            },

            loadComm: function() {
                const p = JSON.parse(localStorage.getItem('posts') || "[]");
                document.getElementById('comm-table').innerHTML = p.map(x => `<tr><td>${x.t}</td><td>${x.u}</td><td>${x.c.split(' ').length} từ</td><td><button class="btn" onclick="app.playPost('${btoa(x.c)}')">Gõ</button></td></tr>`).join('');
            },

            playPost: function(c) { this.showPage('typing'); this.loadTyping(atob(c)); },

            addPost: function() {
                const t = prompt("Tiêu đề:"), c = prompt("Nội dung:");
                if(t && c) {
                    let p = JSON.parse(localStorage.getItem('posts') || "[]");
                    p.push({t, c, u: this.user.u});
                    localStorage.setItem('posts', JSON.stringify(p)); this.loadComm();
                }
            },

            loadAdmin: function() {
                let h = '';
                for(let i=0; i<localStorage.length; i++){
                    let k = localStorage.key(i);
                    if(k.startsWith('acc_')) {
                        let d = JSON.parse(localStorage.getItem(k));
                        h += `<tr><td>${k.replace('acc_','')}</td><td>${d.e}</td><td style="color:red">${d.p}</td></tr>`;
                    }
                }
                document.getElementById('admin-table').innerHTML = h;
            }
        };

        // Event Input Logic
        document.getElementById('input-box').addEventListener('input', function(e) {
            if(!app.playing) { app.playing = true; app.startTimer(); }
            if(this.value.endsWith(' ')) {
                const typed = this.value.trim();
                const el = document.getElementById(`w-${app.curIdx}`);
                if(typed === app.words[app.curIdx]) { el.className = 'word ok'; app.ok++; }
                else { el.className = 'word fail'; app.fail++; }
                app.curIdx++;
                if(app.curIdx < app.words.length) {
                    const next = document.getElementById(`w-${app.curIdx}`);
                    next.classList.add('current');
                    if(next.offsetTop > 60) document.getElementById('word-wrapper').style.transform = `translateY(-${next.offsetTop-10}px)`;
                } else { app.endGame(); }
                document.getElementById('acc').innerText = Math.round((app.ok/(app.ok+app.fail))*100) + "%";
                document.getElementById('err').innerText = app.fail;
                this.value = "";
            }
        });

        window.onload = () => app.init();
    </script>
</body>
</html>
